---
import { db } from "../../db";
import StatItem from "../molecules/StatItem.astro";
import reportIcon from "../../assets/icons/report.svg?raw";

const reencontradosCount = await db.post.count({
  where: { type: "found" },
});

const adoptadosCount = await db.post.count({
  where: { type: "adopt" },
});
---

<section class="hero-section">
  <div class="hero-background">
    <!-- Abstract organic blobs for background -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
  </div>

  <div class="container hero-container">
    <div class="hero-content">
      <span class="badge" id="hero-badge">Guatapé, Antioquia</span>
      <h1 class="hero-title" id="hero-title">
        Reconectando patas y corazones en Guatapé
      </h1>
      <p class="desc-text hero-desc" id="hero-desc">
        La primera red comunitaria de Guatapé para ayudar a mascotas perdidas a
        volver a casa y conectar animales rescatados con familias amorosas.
      </p>

      <div class="hero-actions" id="hero-actions">
        <a href="/publicar" class="btn btn-primary">
          <Fragment set:html={reportIcon} />
          Reportar Mascota
        </a>
        <a href="#casos-recientes" class="btn btn-secondary">
          Ver Casos Recientes
        </a>
      </div>

      <div class="hero-stats" id="hero-stats">
        <StatItem count={reencontradosCount} label="Reencontrados" />
        <div class="stat-divider"></div>
        <div class="stat-item">
          <StatItem count={adoptadosCount} label="Adoptados" />
        </div>
      </div>
    </div>
  </div>

  <style>
    .hero-section {
      position: relative;
      padding-top: calc(var(--nav-height) + 4rem);
      padding-bottom: 6rem;
      min-height: 100vh;
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .hero-background {
      position: absolute;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      background-color: var(--c-surface-secondary);
    }

    .blob {
      position: absolute;
      filter: blur(80px);
      opacity: 0.6;
      border-radius: 50%;
      z-index: -1;
    }

    .blob-1 {
      top: -10%;
      right: -5%;
      width: 600px;
      height: 600px;
      background: #d69f7e;
    }

    .blob-2 {
      bottom: -20%;
      left: -10%;
      width: 500px;
      height: 500px;
      background: #ebd0bf;
    }

    .hero-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 4rem;
      align-items: center;
      position: relative;
      z-index: 10;
    }

    @media (min-width: 1024px) {
      .hero-container {
        grid-template-columns: 1.2fr 0.8fr;
      }
    }

    .badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: rgba(138, 80, 48, 0.15);
      color: var(--c-secondary);
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(138, 80, 48, 0.3);
    }

    .hero-title {
      margin-bottom: 1.5rem;
      color: var(--c-text);
    }

    .hero-desc {
      margin-bottom: 2.5rem;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 3.5rem;
    }

    .hero-stats {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .stat-divider {
      width: 2px;
      height: 40px;
      background-color: var(--c-secondary);
      opacity: 0.2;
    }
  </style>

  <script>
    import gsap from "gsap";

    // Hero Animations
    const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

    tl.from("#hero-badge", { y: 20, opacity: 0, duration: 0.6, delay: 0.4 })
      .from("#hero-title", { y: 30, opacity: 0, duration: 0.8 }, "-=0.3")
      .from("#hero-desc", { y: 20, opacity: 0, duration: 0.8 }, "-=0.5")
      .from("#hero-actions", { y: 20, opacity: 0, duration: 0.6 }, "-=0.4")
      .from("#hero-stats", { y: 20, opacity: 0, duration: 0.6 }, "-=0.2")
      .to(
        ".blob-1",
        {
          y: 30,
          x: -20,
          duration: 4,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut",
        },
        0,
      )
      .to(
        ".blob-2",
        {
          y: -40,
          x: 30,
          duration: 5,
          repeat: -1,
          yoyo: true,
          ease: "sine.inOut",
        },
        0,
      );
  </script>
</section>
